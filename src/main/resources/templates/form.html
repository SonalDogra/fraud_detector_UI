<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Fraud Transaction Analyzer</title>
</head>
<body>
<h1>Enter Transaction Details</h1>

<form method="post" action="/analyze">
    <!-- Hidden field for session ID -->
    <input type="hidden" id="sessionId" name="sessionId" th:value="${sessionId}" />

    <label>Consumer ID:</label><br>
    <input type="text" name="consumerId" required><br><br>

    <label>Amount (‚Çπ):</label><br>
    <input type="number" name="amount" step="0.01" required><br><br>

    <label>Location:</label><br>
    <input type="text" name="location" required><br><br>

    <label>Transaction Hour (0‚Äì23):</label><br>
    <input type="number" name="hour" min="0" max="23" required><br><br>

    <label>Device ID:</label><br>
    <input type="text" name="deviceId" required><br><br>

    <label>Known Locations (comma-separated):</label><br>
    <input type="text" name="knownLocationsInput" required><br><br>

    <label>Known Devices (comma-separated):</label><br>
    <input type="text" name="knownDevicesInput" required><br><br>

    <label>Average Transaction Amount (‚Çπ):</label><br>
    <input type="number" name="averageTransactionAmount" step="0.01" required><br><br>

    <label>Recent Flags (comma-separated):</label><br>
    <input type="text" name="recentFlagsInput"><br><br>

    <button type="submit">üîç Analyze Transaction</button>
</form>

<!-- ‚úÖ Session Logging Script -->
<script>
    document.addEventListener("DOMContentLoaded", async () => {
        try {
            // Fetch session ID from server
            const res = await fetch("https://fraud-detector-ui.onrender.com/get-session-id");
            const { sessionId } = await res.json();

            // Store session ID in hidden input
            document.getElementById("sessionId").value = sessionId;

            // Simulate user typing behavior
            const data = {
                fingerprint: navigator.userAgent,
                timezoneOffset: new Date().getTimezoneOffset(),
                typing_interval_ms: 150 + Math.floor(Math.random() * 50)
            };

            // Log session behavior to AI backend
            await fetch("https://fraud-detector-agent.onrender.com/log-session", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ session_id: sessionId, data })
            });

            console.log("‚úÖ Session behavior logged");
        } catch (error) {
            console.error("‚ùå Session logging failed:", error);
        }
    });
</script>
</body>
</html>
